STM32学习笔记(一)---基础知识

[TOC]

## 串口通讯协议

### 物理层

1. 串口通讯结构图

   ![1565592406179](.\图片\1565592406179.png)

2. 根据通讯使用的**电平标准**不同，串口通讯可以分为**TTL**标准和**RS-232**标准。

   | 通讯标准 | 电平标准                                                     |
   | -------- | ------------------------------------------------------------ |
   | 5V TTL   | 逻辑1：2.4V-5V                                                                                                                               逻辑0：0-0.5V |
   | RS-232   | 逻辑1：-15V~-3V                                                                                                                     逻辑0：+3V~+15V |

### 协议层

**串口数据包的基本组成：**

![串口数据包的基本组成](.\图片\1565592551337.png)

1. 波特率

   两个通讯设备之间需要约定好波特率，即每个码元的长度，以便对信号进行解码。

2. 通讯的起始和停止信号

   起始信号由一个数据0位表示，停止信号可由0.5、1、1.5、2个逻辑1的数据位表示。

3. 有效数据

4. 数据校验

   奇校验

   偶校检

   0校验

   1校验

   无校验

## USART功能框图

![1565593455951](.\图片\1565593455951.png)

### 1. 引脚

**TX：**数据发送引脚

**RX：**数据接收引脚

**SW_RX：**数据接收引脚，只用于单线和智能卡模式，内部引脚，无引出。

**nRTS：**请求以发送（Request To Send），n表示低电平有效。如果使能 RTS 流控制，当
USART 接收器准备好接收新数据时就会将 nRTS 变成低电平；当接收寄存器已满时，
nRTS 将被设置为高电平。该引脚只适用于硬件流控制。 

**nCTS：**清除以发送(Clear To Send)， n 表示低电平有效。如果使能 CTS 流控制，发送
器在发送下一帧数据之前会检测 nCTS 引脚，如果为低电平，表示可以发送数据，如果为
高电平则在发送完当前数据帧之后停止发送。该引脚只适用于硬件流控制。 

**SCLK：**发送器时钟输出引脚。这个引脚仅适用于同步模式。 

​     **USART引脚汇总：**

![1565594168092](.\图片\1565594168092.png)

### 2. 数据寄存器

数据寄存器（USART_DR）实际包含两个寄存器，一个用于发送（TDR），一个用于接收（RDR）。

### 3. 控制器

参见参考手册的USART_CR1和USART_SR寄存器的功能说明

#### 发送器

#### 接收器

### 4. 小数波特率生成

## USART软件应用

### 1. 轮询方式发送接收

### 2. 中断方式发送接收

### 3. 利用串口空闲中断，接收不定长数据

### 4. 串口DMA发送接收

